using System;
using System.Data.SqlClient;
using MSSQLTool.Utils;
using System.Collections.Generic;

namespace MSSQLTool
{
    class Program
    {
        static void Main(string[] args)
        {
            Dictionary<string, string> parser = ArgParser.parse(args);

            int size = parser.Count;

            if (size != 3)
            {
                Console.WriteLine("Usage: exe (/enumerate or /attack) /sqlServer:<name> (/database:<name>) ");
                Environment.Exit(0);
            }

            String sqlServer = parser["/sqlServer"];
            String database = "master";
            bool enumerate = true;
            bool attack = false;

            if (parser.ContainsKey("/attack"))
            {
                enumerate = false;
                attack = true;
            }

            Console.WriteLine(String.Format("sqlServer: {0}, database: {1}, enumerate: {2}", sqlServer, database, enumerate));

            if (parser.ContainsKey("/database"))
            {
                database = parser["/database"];
            }
            
            SqlConnection con = Connector.connect(sqlServer, database);

            if (enumerate)
            {
                Enumerator.enumerate(con);
            }

        }
    }
}
